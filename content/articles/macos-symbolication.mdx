---
slug: /articles/macos-symbolication
title: 'Debudding macOS App Crashes - macOS App Symbolication'
description: "Xcode doesn't yet have support for importing macOS crash logs and symbolizing them. Learn how to do it through the command line."
published: 1580980635
updated: 1590286505
authors:
    - mattdavo
tags:
    - xcode
    - debugging
    - cocoa
links:
    - title: Bob Matcuk Guide
      to: 'https://gist.github.com/bmatcuk/c55a0dd4f8775a3a2c5a'
---

# Debudding macOS App Crashes - macOS App Symbolication

Recently I received feedback that [Yippy](https://yippy.mattdavo.com/) wasn't running when opened, so I needed to fix this. The users weren't getting any error message either which wasn't very helpful. This led me astray for a while as I thought the app wasn't starting at all and the issue was due code signing, as I am exporting Yippy without signing it. After some experimentation I discovered that this wasn't the issue.

After discovering that app was running (and ultimately crashing very soon after) I tried running the app via terminal, like so:

```bash
$ cd /Applications/Yippy.app/Contents/MacOS
$ ./Yippy
```

The app would run and ultimately crash with an error `Illegal instruction 4` and [this post](https://stackoverflow.com/questions/14268887/what-is-the-illegal-instruction-4-error-and-why-does-mmacosx-version-min-10) led me to thinking that the issue was with versioning as the other machine was running on a different version of macOS. I tried adding `-mmacosx-version-min=10.14` to the compile flags but had no such success. I then discovered through another [post](https://stackoverflow.com/a/33046894) that the issue could be as simple as unconditionally unwrapping `nil` instance with `!`.

This led me back to trying to symbolicate the crash log, which I had briefly tried before but with no success. This is because it is not possible to import macOS crash logs into Xcode and symbolicate then unlike with iOS. If the crash was on a install from the Mac App Store we could download the crash report in Xcode, and for iOS you can download or import crash logs. Since Yippy is not distributed over the Mac App Store (because it is not Sandboxed), we must obtain the crash reports from the users and symbolicate them ourselves!

> **Symbolication**: The replacement of memory addresses with human-readable function names and line numbers.

## macOS App Symbolication

I found [this](https://gist.github.com/bmatcuk/c55a0dd4f8775a3a2c5a) great step-by-step guide by [Bob Matcuk](https://github.com/bmatcuk) on how to symbolicate macOS crash logs in your terminal. I recommend reading it for a more detailed understanding but I will run through the steps that I took to find my bug.

### 1. Get the crash log

To understand the crash you must obtain the crash log. Crash logs can be obtained from the app **Console** found in the **Utilities** folder of your **Applications** folder.

### 2. Find your dSYM file(/s) and the version of your app

You need to keep your archives of your apps if you would like to symbolicate them. This is so you have dSYM files and the corresponding archive of your app. You can access these through Xcode by opening the Organizer window (`Window > Organizer`), then right clicking on the desired archive and selecting **Show in Finder**. Then right click on the archive and select **Show Package Contents**. From there you can copy your actual application and the dSYMs of your app and any frameworks that may need to be symolicated as well.

For simplicity copy them to a temporary folder anywhere on your computer and open that folder in your terminal.

[Here is my folder](https://mattdavo.com/files/debug-yippy.zip) that you can use to follow along with. In there you will find all the dSYMs, the Yippy app and the crash log.

> Note: A dSYM file is a debug symbols file generated by Xcode.

### 3. Check you have the right build (optional)

To check we have the right build we compare the UUID of the app to the one in the crash log.
First we'll check the id of the app.

```bash
$ xcrun dwarfdump --uuid Yippy.app/Contents/MacOS/Yippy
UUID: 1EFC00EE-3115-3E12-A474-FC75B30422AA (x86_64) Yippy.app/Contents/MacOS/Yippy
```

Next, we find our app in the **Binary Images** section of the crash log. It should be the first one. Our line is:

```bash
0x10690e000 -        0x106960fff +MatthewDavidson.Yippy (2.1.0 - 1) <1EFC00EE-3115-3E12-A474-FC75B30422AA> /Applications/Yippy.app/Contents/MacOS/Yippy
```

We can see we have the right build as both have the same id: `1EFC00EE-3115-3E12-A474-FC75B30422AA`.

### 4. Find the load address

Using the same line in the **Binary Images** section of the crash log we can find load address of our app, the very first address on the line. Ours is `0x10690e000`.

### 5. Determine addresses of interest

Now we look through the crash log and look for any addresses that we want more information about, i.e. what line of what file they are referring to. In our case, the crash log indicates that Thread 0 crashed, and it provides us with the call stack:

```none
Thread 0 Crashed:: Dispatch queue: com.apple.main-thread
0   MatthewDavidson.Yippy         	0x0000000106951630 0x10690e000 + 276016
1   libdispatch.dylib             	0x00007fff5f1a863d _dispatch_client_callout + 8
2   libdispatch.dylib             	0x00007fff5f1a9d4b _dispatch_once_callout + 20
3   libswiftCore.dylib            	0x00007fff5ec2e7e9 swift_once + 25
4   MatthewDavidson.Yippy         	0x0000000106914a21 0x10690e000 + 27169
5   libdispatch.dylib             	0x00007fff5f1a863d _dispatch_client_callout + 8
6   libdispatch.dylib             	0x00007fff5f1a9d4b _dispatch_once_callout + 20
7   libswiftCore.dylib            	0x00007fff5ec2e7e9 swift_once + 25
8   MatthewDavidson.Yippy         	0x0000000106914783 0x10690e000 + 26499
9   libdispatch.dylib             	0x00007fff5f1a863d _dispatch_client_callout +
```

If there isn't a section like this in the crash log also look for section called **Application Specific Backtrace**.

### 6. Using `atos` to symbolicate

Let's start at the top of the call stack with the crash in Yippy, frame 0. The log shows that the address of the crash is at `0x0000000106951630`, so we will use the command line tool `atos` to learn more information about the address. We will use it in the following format:

```bash
atos -o <yippy executable> -arch x86_64 -l <load address> <address of interest>
```

So let's do that:

```bash
$ atos -o Yippy.app/Contents/MacOS/Yippy -arch x86_64 -l 0x10690e000 0x0000000106951630
globalinit_33_8670F2B310FD7A45CCB0F3599A90E1A6_func94Tm (in Yippy) + 128
```

Hmm, that wasn't super helpful. Let's try the next address in Yippy, frame 4 at address `0x0000000106914a21`:

```bash
$ atos -o Yippy.app/Contents/MacOS/Yippy -arch x86_64 -l 0x10690e000 0x0000000106914a21
globalinit_33_E8D85A6A621F482762673B5D9C2C771A_func4 (in Yippy) (YippyTextCellView.swift:28)
```

There we go! We have a line for the crash. Here is this version of [YippyTextCellView.swift](https://github.com/mattDavo/Yippy/blob/eec737c25308374017cc7e25aa8de24d885ec26b/Yippy/Sources/Windows/Yippy/CellViews/YippyTextCellView.swift#L28).

```Swift
static let font = Constants.fonts.yippyPlainText
```

Ok, now let's have a look at that definition. Here is this version of the [Constants.swift](https://github.com/mattDavo/Yippy/blob/eec737c25308374017cc7e25aa8de24d885ec26b/Yippy/Sources/Constants/Constants.swift#L30):

```Swift
static let yippyPlainText = NSFont(name: "Roboto Mono Light for Powerline", size: 12)!
```

Ah, we must be failing to load the font! Lesson learned!

### Conclusion

There we have it, we now know how to symbolicate a macOS crash log in the terminal. It's not too hard, get the crash log, correct version of the app, dSYM files. Then find the load address and use `atos` to inspect addresses in the call stack!
